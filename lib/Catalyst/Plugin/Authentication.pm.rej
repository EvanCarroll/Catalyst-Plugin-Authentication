***************
*** 397,403 ****
      sub restricted : Local {
          my ( $self, $c ) = @_;
  
-         $c->detach("unauthorized") unless $c->check_roles("admin");
  
          # do something restricted here
      }
--- 397,403 ----
      sub restricted : Local {
          my ( $self, $c ) = @_;
  
+         $c->detach("unauthorized") unless $c->check_user_roles("admin");
  
          # do something restricted here
      }
